@page "/Peces"
@inject HttpClient client 

<PageTitle>Peces | Murky Shop</PageTitle>

<link rel="stylesheet" href="css/warcraft.css" />
<link rel="stylesheet" href="css/UsualButon.css" />

<style>
    body {
        background: url('/Images/Azshara.jpg') no-repeat center center fixed;
        background-size: cover;
    }
</style>

<body>
    <br>
    <br>
    <br>
    <br>
    @if (Allpeces == null || peces == null)
    {
        <h5>No hay peces disponibles</h5>
        <br>
        <br>
        <br>
        <br>
        <br>
        <div class="container text-center">
            <div class="row justify-content-md-center">
                <div class="col col-lg-2">
                </div>
                <div class="col-md-auto">
                    <img src="/Images/torty.png" style="width: 300px; height: auto;" alt="">
                </div>
                <div class="col col-lg-2">
                </div>
            </div>
        </div>

    }
    else
    {
        @foreach (var (pez, product) in Allpeces.Zip(peces, (p, pr) => (p, pr)))
        {
            <div class="container">
                <div class="row">
                    <div class="col">
                    </div>

                    <div class="col-4">
                        <img src="@pez.ImageURL" style="float: left;
                                 width: 500px;
                                 height: auto;" alt="" class="img-thumbnail">
                    </div>

                    <div class="col-5 text-center" style="font-size:40px; place-items: center;">

                        <h1 style="font-size:50px">@pez.Nombre</h1>
                        <br>
                        <h1>@pez.Descripcion</h1>
                        <br>
                        <h1>Agua: @pez.Agua</h1>
                        <br>
                        <h1>pH: @pez.pH</h1>
                        <br>
                        <h1>Temperatura: @pez.Temperatura</h1>
                        <br>
                        <h1>Precio por unidad: $@pez.Precio</h1>
                        <br>
                        <button class="boton-usual" type="submit" onclick="redirec(@product.Id)" style="font-size:35px">Comprar</button>
                    </div>

                    <div class="col">
                    </div>
                </div>
            </div>
            <br>
            <br>
            <br>
            <br>
        }
    }
    <br>
    <br>
    <br>
    <h1 style="font-size:18px">Esta pagina fue creada con fines academicos sin fines de lucro; el nombre, asi como el arte en las imagenes son propiedad de Blizzard Entertainment, Inc.</h1>
</body>

<script>
    function redirec(productId) {
        window.location.href = `/ProductDetails/${productId}`;
    }
</script>

@code {
    List<Pez> Allpeces = new List<Pez>();
    List<Pez> peces = new List<Pez>();

    [Inject]
    public IShoppingCartService ShoppingCartService { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Allpeces = await client.GetFromJsonAsync<List<Pez>>("api/Peces");

        var allProducts = await client.GetFromJsonAsync<List<ProductDto>>("api/Catalogos");

        peces = allProducts.Where(p => p.CategoryId == 1).Select(p => new Pez
            {
                Id = p.Id,
            }).ToList();

        var shoppingCartItems = await ShoppingCartService.GetItems(HardCoded.UserId);
        var totalQty = shoppingCartItems.Sum(i => i.Qty);

        ShoppingCartService.RaiseEventOnShoppingCartChanged(totalQty);
    }
}

