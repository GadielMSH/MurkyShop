@page "/Filtros"
@inject HttpClient client

<PageTitle>Filtros | Murky Shop</PageTitle>

<link rel="stylesheet" href="css/warcraft.css" />
<link rel="stylesheet" href="css/UsualButon.css" />

<body>
    <br>
    <br>
    <br>
    <br>
    @if (Allfiltros == null || filtros == null)
    {
        <h5>No hay filtros disponibles</h5>
        <br>
        <br>
        <br>
        <br>
        <br>
        <div class="container text-center">
            <div class="row justify-content-md-center">
                <div class="col col-lg-2">
                </div>
                <div class="col-md-auto">
                    <img src="/Images/torty.png" style="width: 300px; height: auto;" alt="">
                </div>
                <div class="col col-lg-2">
                </div>
            </div>
        </div>
    }
    else
    {
        @foreach (var (filtro, product) in Allfiltros.Zip(filtros, (p, pr) => (p, pr)))
        {
            <div class="container">
                <div class="row">
                    <div class="col">
                    </div>

                    <div class="col-4">
                        <img src="@filtro.ImageURL" style="float: left;
                                 width: 250px;
                                 height: auto;" alt="" class="img-thumbnail">
                    </div>

                    <div class="col-5 text-center" style="font-size:40px; place-items: center;">

                        <h1 style="font-size:50px">@filtro.Nombre</h1>
                        <br>
                        <h1>@filtro.Descripcion</h1>
                        <br>
                        <h1>Modelo: @filtro.Modelo</h1>
                        <br>
                        <h1>Precio por unidad: $@filtro.Precio</h1>
                        <br>
                        <button class="boton-usual" type="submit" onclick="redirec(@product.Id)" style="font-size:35px">Comprar</button>
                    </div>

                    <div class="col">
                    </div>
                </div>
            </div>
            <br>
            <br>
            <br>
            <br>
        }
    }
    <br>
    <br>
    <br>
    <h1 style="font-size:18px">Esta pagina fue creada con fines academicos sin fines de lucro; el nombre, asi como el arte en las imagenes son propiedad de Blizzard Entertainment, Inc.</h1>
</body>

<script>
    function redirec(productId) {
        window.location.href = `/ProductDetails/${productId}`;
    }
</script>

@code {
    List<Filtro> Allfiltros = new List<Filtro>();
    List<Filtro> filtros = new List<Filtro>();

    [Inject]
    public IShoppingCartService ShoppingCartService { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Allfiltros = await client.GetFromJsonAsync<List<Filtro>>("api/Filtros");

        var allProducts = await client.GetFromJsonAsync<List<ProductDto>>("api/Catalogos");

        filtros = allProducts.Where(p => p.CategoryId == 3).Select(p => new Filtro
            {
                Id = p.Id,
            }).ToList();


        var shoppingCartItems = await ShoppingCartService.GetItems(HardCoded.UserId);
        var totalQty = shoppingCartItems.Sum(i => i.Qty);

        ShoppingCartService.RaiseEventOnShoppingCartChanged(totalQty);
    }
}
